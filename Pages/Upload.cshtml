@page
@model MedicalImageAnalysis.Web.Pages.UploadModel
@{
    ViewData["Title"] = "Upload Medical Image";
}

<h2>Upload Medical Image</h2>

<form method="post" enctype="multipart/form-data">
  <input type="file" asp-for="UploadedFile" accept=".dcm,.png,.jpg,.jpeg,.nii" />
  <button type="submit">Upload</button>
</form>

@* PREVIEW *@
@if (Model.DisplayImageUrl != null) 
{
  <h3>Preview:</h3>
  <img src="@Model.DisplayImageUrl" style="max-width: 800px; border: 1px solid #ccc;" />
  
  <div style="margin-top: 10px;">
    <form method="post" asp-page-handler="ApplyOtsu" style="display: inline-block; margin-right: 10px;">
        <input type="hidden" asp-for="DisplayImageUrl" />
        <input type="hidden" asp-for="KMeans_K" />
        <button type="submit">Apply Otsu Thresholding</button>
    </form>
    
    <form method="post" asp-page-handler="ApplyKMeans" style="display: inline-block;">
        <input type="hidden" asp-for="DisplayImageUrl" />
        <label for="KMeans_K">Clusters (K):</label>
        <input asp-for="KMeans_K" type="number" min="2" max="10" style="width: 60px;" />
        <button type="submit">Apply K-means</button>
    </form>
  </div>
}

@if (Model.OtsuImageUrl != null)
{
    <h3>Otsu Result:</h3>
    <img src="@Model.OtsuImageUrl" style="max-width: 800px; border: 1px solid #ccc;" />
}

@if (Model.KMeansImageUrl != null)
{
    <h3>K-means Result (K=@Model.KMeans_K):</h3>
    <img src="@Model.KMeansImageUrl" style="max-width: 800px; border: 1px solid #ccc;" />
}

@if (Model.Modality != null)
{
  <div style="margin-top: 20px; padding: 10px; background: #f5f5f5; border-radius: 4px;">
      <h4>DICOM Metadata</h4>
      <p><strong>Patient:</strong> @Model.PatientName</p>
      <p><strong>Modality:</strong> @Model.Modality</p>
  </div>
}