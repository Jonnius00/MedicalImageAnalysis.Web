# ğŸ¥ MedicalImageAnalysis.Web

A modular ASP.NET Core web application for uploading, visualizing, and analyzing medical images (DICOM, NIfTI, PNG, JPG). Designed for extensibility and cross-language reproducibility, this project is designated for showcasing basic medical image processing pipelines. 
Completed roadmap stages with example pictures are presented below.

## Features

- ğŸ“¤ **Image Upload & Display**  
  Upload DICOM, PNG, JPG, and (planned) NIfTI files via a simple web UI.  
  DICOM metadata (patient, modality) is extracted and displayed.  
  Uploaded images are rendered and previewed in-browser.

- ğŸ§© **Modular Architecture**  
  - **Pages/**: Razor Pages UI  
  - **Services/**: Core logic (preprocessing, clustering, segmentation)  
  - **Models/**: Data models (e.g., image data, pipeline configs)  
  - **Data/**: File I/O and dataset loading  
  - **Utils/**: Shared helpers (image conversion, metrics, timing)

- ğŸš€ **Core Functionalities (Implemented)**  
  - **Data Loading**: DICOM, PNG, JPG (NIfTI skipped for now)
  - **Preprocessing**: PCA using Math.NET Numerics âœ…
  - **Clustering**: K-means with configurable clusters âœ…
  - **Segmentation Algorithms**: 
    - Otsu Thresholding âœ…
    - Region Growing with adjustable tolerance âœ…
    - Watershed (distance transform-based) âœ…
  - **Visualization**: Flexible responsive grid with side-by-side comparison âœ…

- âš™ï¸ **Pipeline Execution & State Management**  
  - Upload â†’ Preprocessing (PCA) â†’ Clustering (K-means) â†’ Segmentation (Otsu, Region Growing, Watershed)
  - Persistent image state across postbacks via model binding
  - DICOM metadata extraction and display
  - Support for multi-frame DICOM files (frame count detection)

- ğŸŒ **Cross-Language Consistency**  
  - Deterministic seeds for reproducibility  
  - Well-defined input/output contracts  
  - Designed for future porting to Python or other languages

## ğŸ› ï¸ Tech Stack

- **ASP.NET Core Razor Pages** (.NET 8)
- **fo-dicom** (DICOM support)
- **SixLabors.ImageSharp** (image processing)
- **MathNet.Numerics** (math, PCA, clustering)
- **Bootstrap, jQuery** (UI)

## â–¶ï¸ Getting Started

1. **Clone the repository**
   ```
   git clone https://github.com/Jonnius00/MedicalImageAnalysis.Web
   ```
2. **Install dependencies**  
   ```
   dotnet restore
   ```
3. **Build and run**  
   ```
   dotnet run
   ```
4. **Open in browser**  
   Navigate to `https://localhost:<port>` (port indicated in console)

## ğŸ“ Project Structure

```
MedicalImageAnalysis.Web/
â”œâ”€â”€ Pages/                 # Razor Pages UI (Upload.cshtml with image grid)
â”œâ”€â”€ Services/              # Core algorithm logic (implemented)
â”‚   â”œâ”€â”€ OtsuService.cs
â”‚   â”œâ”€â”€ KMeansService.cs
â”‚   â”œâ”€â”€ PCAPreprocessingService.cs
â”‚   â”œâ”€â”€ RegionGrowingService.cs
â”‚   â””â”€â”€ WatershedService.cs
â”œâ”€â”€ wwwroot/               # Static assets (CSS, JS, uploaded images)
â”‚   â”œâ”€â”€ css/site.css       # Responsive grid layout
â”‚   â”œâ”€â”€ images/            # Uploaded and processed images
â”‚   â””â”€â”€ js/site.js
â”œâ”€â”€ Program.cs             # Dependency injection setup
â”œâ”€â”€ MedicalImageAnalysis.Web.csproj
â””â”€â”€ Properties/launchSettings.json
```

## ğŸ“… Roadmap & Implementation Status

### âœ… Completed Features

- **Data Loading**: DICOM/PNG/JPG upload & preview with metadata extraction
  ![DICOM/PNG/JPG upload & preview](wwwroot/images/71583a9c-8f4f-4862-a027-85b398dba39f.png)

- **Segmentation algorithms:** Binary segmentation by Otsu with automatic threshold computation
  ![Otsu segmentation](wwwroot/images/dbd14dee-41a5-4cb0-bf20-5098508112e0_otsu.png)

- **K-means Clustering**: Configurable cluster count (2-10) with color visualization
  ![K-means clustering](wwwroot/images/d9b6870b-49af-44f7-8d5b-0ac77193fe12_kmeans.png)

- **PCA Preprocessing**: shows reconstructed from top 2 components image. with explained variance ratios
  ![PCA preprocessing](wwwroot/images/4381661a-8ce2-425e-b391-5c7173c47904_pca.png)

- **Region Growing**: Seed-based segmentation with adjustable tolerance
  ![Region growing](wwwroot/images/b3e55dc7-fc94-45a8-9aba-85afdc75a905_regiongrowing.png)

- **Watershed Segmentation**: Distance transform-based segmentation with marker detection
![Watershed](wwwroot/images/7543f350-5730-4338-a533-0163b16ac24f_watershed.png)
  
- **Responsive Grid Layout**: Flexible CSS Grid that adapts to screen size
  - Side-by-side image comparison with proper aspect ratio preservation
  - Dynamic grid that scales from 1 column (mobile) to 3+ columns (desktop)
  - DICOM metadata persistence across algorithm applications

### ğŸ› ï¸ In Progress / Future Improvements

- [ ] Multi-frame DICOM processing (currently detects frame count only)
- [ ] Performance metrics and execution timing
- [ ] Interactive overlays (Canvas/SVG for pixel-level inspection)
- [ ] Pipeline configuration UI and JSON serialization
- [ ] NIfTI file format support (skipped for now)

## ğŸ¯ Key Implementation Details

### Algorithm Determinism
- All clustering and segmentation use fixed random seeds (e.g., `Random(42)`) for reproducibility
- Enables cross-language porting with guaranteed identical results

### Image Pipeline
1. **Upload**: DICOM/PNG/JPG â†’ normalized to grayscale (L8) byte array
2. **Processing**: All algorithms operate on byte[] for cross-platform compatibility
3. **Visualization**: Results converted to RGBA32 images with distinct colors
4. **Storage**: PNG format (lossless, suitable for medical imaging)

### Responsive Design
- CSS Grid uses `repeat(auto-fit, minmax(300px, 1fr))` for flexible columns
- Breakpoints: Desktop (3+ cols), Tablet (2-3 cols), Mobile (1 col)
- Images maintain aspect ratio with `object-fit: contain`

## ğŸ“œ License

This project uses open-source libraries under MIT and similar licenses:
- fo-dicom 5.1.5 (DICOM support)
- SixLabors.ImageSharp 3.1.11 (image processing)
- MathNet.Numerics 5.0.0 (algorithms)
- Bootstrap, jQuery (UI components)

See `/wwwroot/lib/*/LICENSE` for details. 
